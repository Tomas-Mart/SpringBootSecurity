<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Админ панель</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #6c757d;
      --dark-color: #343a40;
      --light-color: #f8f9fa;
      --danger-color: #dc3545;
      --success-color: #28a745;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-color);
    }

    .navbar-dark {
      background-color: var(--dark-color) !important;
      padding: 10px 20px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar {
      background-color: var(--primary-color);
      min-height: 100vh;
      width: 220px;
      padding: 20px;
      color: white;
      position: fixed;
      top: 56px;
      bottom: 0;
      overflow-y: auto;
      transition: all 0.3s;
    }

    .main-content {
      margin-left: 220px;
      padding: 30px;
      margin-top: 56px;
      background-color: white;
      min-height: calc(100vh - 56px);
      border-radius: 10px 0 0 0;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.05);
    }

    .sidebar .nav-link {
      background-color: rgba(255, 255, 255, 0.15);
      color: white !important;
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 8px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
    }

    .sidebar .nav-link i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    .sidebar .nav-link:hover {
      background-color: rgba(255, 255, 255, 0.25);
      transform: translateX(5px);
    }

    .sidebar .nav-link.active {
      background-color: rgba(255, 255, 255, 0.3);
      font-weight: 500;
    }

    .table {
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .table th {
      background-color: var(--light-color);
      color: var(--secondary-color);
      font-weight: 500;
    }

    .form-container {
      max-width: 500px;
      margin: 0 auto;
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      font-weight: 500;
      color: var(--secondary-color);
    }

    .button-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
    }

    .editing {
      background-color: #fdea98;
    }

    .bold {
      font-weight: bold;
    }

    .role-items-container {
      gap: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      margin-top: 8px;
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
      background: var(--light-color);
      width: 100%;
    }

    .role-item {
      padding: 8px 12px;
      border-radius: 0.25rem;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .role-item:hover {
      background-color: #e9ecef;
    }

    .role-item.selected {
      color: #fff;
      font-weight: 500;
      background-color: var(--primary-color);
    }

    .d-none {
      display: none;
    }

    .error-message {
      color: var(--danger-color);
      font-size: 0.9em;
      margin-top: 5px;
      display: none;
    }

    .modal-dialog-centered {
      display: flex;
      align-items: center;
      min-height: calc(100% - 1rem);
    }

    .modal-title {
      font-weight: 500;
    }

    .modal-content {
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .bg-light {
      background-color: var(--light-color) !important;
      cursor: not-allowed;
    }

    .delete-modal .modal-body {
      padding: 20px;
    }

    .delete-modal .row {
      margin-bottom: 10px;
      align-items: center;
    }

    .delete-modal .col-3 {
      font-weight: 500;
      padding: 8px;
      background-color: var(--light-color);
      border-radius: 4px;
    }

    .delete-modal .col-9 {
      padding: 8px;
      background-color: var(--light-color);
      border-radius: 4px;
    }

    #rolesError {
      color: var(--danger-color);
      font-size: 0.875em;
      margin-top: 5px;
      display: none;
    }

    .btn-edit {
      color: #fdfdfd;
      background-color: var(--primary-color);
    }

    .user-role {
      font-weight: bold;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      display: inline-block;
    }

    .role-user {
      background-color: var(--success-color);
    }

    .role-admin {
      background-color: var(--danger-color);
    }

    .logout-btn {
      transition: all 0.3s;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
    }

    .nav-tabs .nav-link {
      color: var(--secondary-color);
      font-weight: 500;
    }

    .nav-tabs .nav-link.active {
      color: var(--primary-color);
      font-weight: 500;
    }

    @media (max-width: 992px) {
      .sidebar {
        width: 70px;
        overflow: hidden;
      }

      .sidebar .nav-link span {
        display: none;
      }

      .sidebar .nav-link i {
        margin-right: 0;
        font-size: 1.2rem;
      }

      .main-content {
        margin-left: 70px;
      }
    }
  </style>
</head>
<body>
<nav class="navbar navbar-dark">
  <div class="container-fluid">
    <div class="d-flex align-items-center">
      <span class="text-white me-3" id="currentUserInfo">
        <i class="fas fa-user-circle me-2"></i>
        <span>Загрузка...</span>
      </span>
    </div>
    <button id="logoutBtn" class="btn btn-outline-light logout-btn">
      <i class="fas fa-sign-out-alt me-1"></i> Выйти
    </button>
  </div>
</nav>

<div class="d-flex">
  <div class="sidebar">
    <ul class="nav flex-column">
      <li class="nav-item" id="adminLink">
        <a href="/admin" class="nav-link active">
          <i class="fas fa-table me-2"></i>
          <span>Админка</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/user/profile" class="nav-link">
          <i class="fas fa-user me-2"></i>
          <span>Пользователь</span>
        </a>
      </li>
    </ul>
  </div>

  <div class="main-content">
    <h3 class="mb-4"><i class="fas fa-users-cog me-2"></i>Админ панель</h3>

    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#users">
          <i class="fas fa-users me-1"></i> Пользователи
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#new-user">
          <i class="fas fa-user-plus me-1"></i> Новый пользователь
        </a>
      </li>
    </ul>

    <div class="tab-content mt-4">
      <div class="tab-pane fade show active" id="users">
        <h4 class="mb-4"><i class="fas fa-list me-2"></i>Все пользователи</h4>
        <table class="table table-bordered table-hover">
          <thead>
          <tr>
            <th>ID</th>
            <th>Имя</th>
            <th>Фамилия</th>
            <th>Возраст</th>
            <th>Email</th>
            <th>Роль</th>
            <th>Редактировать</th>
            <th>Удалить</th>
          </tr>
          </thead>
          <tbody id="usersTable">
          <!-- Пользователи будут загружены через JS -->
          </tbody>
        </table>
      </div>
      <div class="tab-pane fade" id="new-user">
        <h4 class="mb-4"><i class="fas fa-plus-circle me-2"></i>Добавить нового пользователя</h4>
        <div class="form-container">
          <form id="userForm">
            <div class="form-group">
              <label class="form-label">Имя</label>
              <input type="text" class="form-control" id="firstName" required>
              <div class="error-message" id="firstNameError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Фамилия</label>
              <input type="text" class="form-control" id="lastName" required>
              <div class="error-message" id="lastNameError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Возраст</label>
              <input type="number" class="form-control" id="age" required min="1">
              <div class="error-message" id="ageError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="email" required>
              <div class="error-message" id="emailError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Пароль</label>
              <input type="password" class="form-control" id="password" required>
              <div class="error-message" id="passwordError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Роль</label>
              <select class="d-none" multiple="multiple" name="roles" required id="rolesSelect">
                <!-- Роли будут загружены через JS -->
              </select>
              <div class="role-items-container" id="rolesContainer">
                <!-- Роли будут загружены через JS -->
              </div>
              <div class="error-message" id="rolesError">Пожалуйста, выберите хотя бы одну роль</div>
            </div>

            <div class="button-container">
              <button type="submit" class="btn btn-primary" onclick="validateRoles()">
                <i class="fas fa-save me-1"></i> Сохранить
              </button>
              <button type="reset" class="btn btn-outline-secondary">
                <i class="fas fa-undo me-1"></i> Сбросить
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Модальное окно редактирования -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-user-edit me-2"></i>Редактировать пользователя</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="editUserForm">
            <input type="hidden" id="editUserId">
            <div class="modal-body">
              <div class="form-group">
                <label class="form-label">ID</label>
                <input type="text" class="form-control bg-light" id="editIdDisplay" readonly>
              </div>
              <div class="form-group">
                <label class="form-label">Имя</label>
                <input type="text" class="form-control" id="editFirstName" required>
              </div>
              <div class="form-group">
                <label class="form-label">Фамилия</label>
                <input type="text" class="form-control" id="editLastName" required>
              </div>
              <div class="form-group">
                <label class="form-label">Возраст</label>
                <input type="number" class="form-control" id="editAge" required min="1">
              </div>
              <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="editEmail" required>
              </div>
              <div class="form-group">
                <label class="form-label">Пароль</label>
                <input type="password" class="form-control" id="editPassword">
                <small class="text-muted">Оставьте пустым, если не хотите менять пароль</small>
              </div>

              <div class="form-group">
                <label class="form-label">Роль</label>
                <select class="d-none" multiple="multiple" name="roles" required id="editRolesSelect">
                  <!-- Роли будут загружены через JS -->
                </select>
                <div class="role-items-container" id="editRolesContainer">
                  <!-- Роли будут загружены через JS -->
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fas fa-times me-1"></i> Закрыть
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i> Сохранить
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Модальное окно удаления -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-user-times me-2"></i>Удалить пользователя</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle me-2"></i>Вы уверены, что хотите удалить этого пользователя?
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">ID:</label>
              <input type="text" class="form-control bg-light" id="deleteUserId" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Имя:</label>
              <input type="text" class="form-control bg-light" id="deleteUserFirstName" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Фамилия:</label>
              <input type="text" class="form-control bg-light" id="deleteUserLastName" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Email:</label>
              <input type="text" class="form-control bg-light" id="deleteUserEmail" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Роль:</label>
              <input type="text" class="form-control bg-light" id="deleteUserRole" readonly>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="fas fa-times me-1"></i> Отмена
            </button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
              <i class="fas fa-trash-alt me-1"></i> Удалить
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    let allRoles = [];
    let currentUser = {};

    // Проверка аутентификации и загрузка данных
    checkAuthAndLoadData();

    // Обработчик кнопки выхода
    $('#logoutBtn').click(function() {
      fetch('/api/logout', {
        method: 'POST',
        credentials: 'include'
      }).then(response => {
        if (response.ok) {
          window.location.href = '/login';
        }
      });
    });

    // Обработчик отправки формы создания пользователя
    $('#userForm').submit(function(e) {
      e.preventDefault();
      createUser();
    });

    // Обработчик отправки формы редактирования пользователя
    $('#editUserForm').submit(function(e) {
      e.preventDefault();
      updateUser();
    });

    // Обработчик кнопки подтверждения удаления
    $('#confirmDeleteBtn').click(function() {
      deleteUser();
    });

    // Делегированные обработчики для кнопок редактирования и удаления
    $('#usersTable').on('click', '.edit-btn', function() {
      const userId = $(this).data('id');
      const firstName = $(this).data('firstname');
      const lastName = $(this).data('lastname');
      const age = $(this).data('age');
      const email = $(this).data('email');
      const roles = $(this).data('roles');

      showEditModal(userId, firstName, lastName, age, email, roles);
    });

    $('#usersTable').on('click', '.delete-btn', function() {
      const userId = $(this).data('id');
      const firstName = $(this).data('firstname');
      const lastName = $(this).data('lastname');
      const age = $(this).data('age');
      const email = $(this).data('email');
      const roles = $(this).data('roles');

      showDeleteModal(userId, firstName, lastName, age, email, roles);
    });
  });

  function checkAuthAndLoadData() {
    fetch('/api/auth/check', {
      method: 'GET',
      headers: {
        'Accept': 'application/json'
      },
      credentials: 'include'
    })
            .then(response => {
              if (!response.ok) {
                window.location.href = '/login';
                throw new Error('Not authenticated');
              }
              return response.json();
            })
            .then(data => {
              if (!data.authenticated || !data.admin) {
                window.location.href = '/access-denied';
              }
              currentUser = data;
              updateCurrentUserInfo();
              loadAdminData();
            })
            .catch(error => {
              console.error('Error:', error);
            });
  }

  function updateCurrentUserInfo() {
    const roles = currentUser.roles.map(role => role.replace('ROLE_', '')).join(', ');
    $('#currentUserInfo span').text(
            `${currentUser.email} (${roles})`
    );
  }

  function loadAdminData() {
    fetch('/api/admin/users', {
      method: 'GET',
      headers: {
        'Accept': 'application/json'
      },
      credentials: 'include'
    })
            .then(response => {
              if (!response.ok) {
                if (response.status === 403) {
                  window.location.href = '/access-denied';
                } else {
                  throw new Error('Failed to load admin data');
                }
              }
              return response.json();
            })
            .then(data => {
              allRoles = data.allRoles;
              renderRoleCheckboxes();
              renderUsersTable(data.users);
            })
            .catch(error => {
              console.error('Error loading admin data:', error);
            });
  }

  function renderRoleCheckboxes() {
    const rolesContainer = $('#rolesContainer');
    const editRolesContainer = $('#editRolesContainer');
    const rolesSelect = $('#rolesSelect');
    const editRolesSelect = $('#editRolesSelect');

    // Очистка существующих опций
    rolesContainer.empty();
    editRolesContainer.empty();
    rolesSelect.empty();
    editRolesSelect.empty();

    // Добавление новых опций
    allRoles.forEach(role => {
      // Для формы создания пользователя
      const roleItem = $('<div></div>')
              .addClass('role-item')
              .attr('data-roleid', role.id)
              .html(`<span>${role.name.replace('ROLE_', '')}</span>`)
              .click(function() {
                $(this).toggleClass('selected');
                const option = rolesSelect.find(`option[value="${role.id}"]`);
                if (option) {
                  option.prop('selected', !option.prop('selected'));
                }
              });
      rolesContainer.append(roleItem);

      const option = $('<option></option>')
              .val(role.id)
              .text(role.name.replace('ROLE_', ''))
              .appendTo(rolesSelect);

      // Для формы редактирования
      const editRoleItem = roleItem.clone(true);
      editRoleItem.click(function() {
        $(this).toggleClass('selected');
        const option = editRolesSelect.find(`option[value="${role.id}"]`);
        if (option) {
          option.prop('selected', !option.prop('selected'));
        }
      });
      editRolesContainer.append(editRoleItem);

      const editOption = option.clone(true);
      editOption.appendTo(editRolesSelect);
    });
  }

  function renderUsersTable(users) {
    const tableBody = $('#usersTable');
    tableBody.empty();

    users.forEach(user => {
      const roles = user.roles.map(role => {
        const roleName = role.replace('ROLE_', '');
        return `<span class="user-role ${role === 'ROLE_ADMIN' ? 'role-admin' : 'role-user'}">${roleName}</span>`;
      }).join(' ');

      const row = $('<tr></tr>')
              .append(`<td>${user.id}</td>`)
              .append(`<td>${user.firstName}</td>`)
              .append(`<td>${user.lastName}</td>`)
              .append(`<td>${user.age}</td>`)
              .append(`<td>${user.email}</td>`)
              .append(`<td>${roles}</td>`)
              .append(`
                    <td>
                        <button class="btn btn-sm btn-primary edit-btn"
                                data-id="${user.id}"
                                data-firstname="${user.firstName}"
                                data-lastname="${user.lastName}"
                                data-age="${user.age}"
                                data-email="${user.email}"
                                data-roles="${user.roles.join(',')}">
                            <i class="fas fa-edit me-1"></i> Редактировать
                        </button>
                    </td>
                `)
              .append(`
                    <td>
                        <button class="btn btn-sm btn-danger delete-btn"
                                data-id="${user.id}"
                                data-firstname="${user.firstName}"
                                data-lastname="${user.lastName}"
                                data-age="${user.age}"
                                data-email="${user.email}"
                                data-roles="${user.roles.join(',')}">
                            <i class="fas fa-trash-alt me-1"></i> Удалить
                        </button>
                    </td>
                `);

      tableBody.append(row);
    });
  }

  function createUser() {
    const firstName = $('#firstName').val();
    const lastName = $('#lastName').val();
    const age = $('#age').val();
    const email = $('#email').val();
    const password = $('#password').val();
    const selectedRoles = $('#rolesContainer .role-item.selected').map((index, item) => $(item).attr('data-roleid')).get();

    if (selectedRoles.length === 0) {
      $('#rolesError').show();
      return;
    } else {
      $('#rolesError').hide();
    }

    const userData = {
      firstName,
      lastName,
      age,
      email,
      password,
      roleIds: selectedRoles.map(Number)
    };

    fetch('/api/admin/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      credentials: 'include',
      body: JSON.stringify(userData)
    })
            .then(response => {
              if (!response.ok) {
                return response.json().then(err => Promise.reject(err));
              }
              return response.json();
            })
            .then(data => {
              loadAdminData();
              $('#userForm')[0].reset();
              $('#rolesContainer .role-item').removeClass('selected');
              alert('Пользователь успешно создан');
            })
            .catch(error => {
              console.error('Error:', error);
              if (error.errors) {
                displayValidationErrors(error.errors);
              } else {
                alert('Ошибка при создании пользователя');
              }
            });
  }

  function showEditModal(userId, firstName, lastName, age, email, roles) {
    $('#editUserId').val(userId);
    $('#editIdDisplay').val(userId);
    $('#editFirstName').val(firstName);
    $('#editLastName').val(lastName);
    $('#editAge').val(age);
    $('#editEmail').val(email);
    $('#editPassword').val('');

    // Очистка предыдущих выборов
    $('#editRolesContainer .role-item').removeClass('selected');

    // Выбор ролей пользователя
    roles.split(',').forEach(role => {
      const roleId = allRoles.find(r => r.name === role)?.id;
      if (roleId) {
        const roleItem = $('#editRolesContainer .role-item[data-roleid="' + roleId + '"]');
        if (roleItem) {
          roleItem.addClass('selected');
        }
      }
    });

    // Открытие модального окна
    const modal = new bootstrap.Modal($('#editUserModal')[0]);
    modal.show();
  }

  function updateUser() {
    const userId = $('#editUserId').val();
    const selectedRoles = $('#editRolesContainer .role-item.selected').map((index, item) => $(item).attr('data-roleid')).get();

    if (selectedRoles.length === 0) {
      alert('Пожалуйста, выберите хотя бы одну роль');
      return;
    }

    const userData = {
      firstName: $('#editFirstName').val(),
      lastName: $('#editLastName').val(),
      age: $('#editAge').val(),
      email: $('#editEmail').val(),
      password: $('#editPassword').val() || null,
      roleIds: selectedRoles.map(Number)
    };

    fetch(`/api/admin/users/${userId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      credentials: 'include',
      body: JSON.stringify(userData)
    })
            .then(response => {
              if (!response.ok) {
                return response.json().then(err => Promise.reject(err));
              }
              return response.json();
            })
            .then(data => {
              loadAdminData();
              const modal = bootstrap.Modal.getInstance($('#editUserModal')[0]);
              modal.hide();
              alert('Пользователь успешно обновлен');
            })
            .catch(error => {
              console.error('Error:', error);
              if (error.errors) {
                displayValidationErrors(error.errors, true);
              } else {
                alert('Ошибка при обновлении пользователя');
              }
            });
  }

  function showDeleteModal(id, firstName, lastName, age, email, roles) {
    $('#deleteUserId').val(id);
    $('#deleteUserFirstName').val(firstName);
    $('#deleteUserLastName').val(lastName);
    $('#deleteUserAge').val(age);
    $('#deleteUserEmail').val(email);

    const roleNames = roles.split(',').map(role => role.replace('ROLE_', '')).join(', ');
    $('#deleteUserRole').val(roleNames);

    const modal = new bootstrap.Modal($('#deleteUserModal')[0]);
    modal.show();
  }

  function deleteUser() {
    const userId = $('#deleteUserId').val();

    fetch(`/api/admin/users/${userId}`, {
      method: 'DELETE',
      credentials: 'include'
    })
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to delete user');
              }
              return response.json();
            })
            .then(data => {
              loadAdminData();
              const modal = bootstrap.Modal.getInstance($('#deleteUserModal')[0]);
              modal.hide();
              alert('Пользователь успешно удален');
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Ошибка при удалении пользователя');
            });
  }

  function displayValidationErrors(errors, isEditForm = false) {
    // Очистка предыдущих ошибок
    $('.error-message').text('').hide();

    // Отображение новых ошибок
    for (const field in errors) {
      const errorElement = $(isEditForm ? `#edit${field.charAt(0).toUpperCase() + field.slice(1)}Error` : `#${field}Error`);
      if (errorElement) {
        errorElement.text(errors[field]).show();
      }
    }
  }

  function validateRoles() {
    const selectedRoles = $('#rolesContainer .role-item.selected').map((index, item) => $(item).attr('data-roleid')).get();
    if (selectedRoles.length === 0) {
      $('#rolesError').show();
      return false;
    }
    $('#rolesError').hide();
    return true;
  }
</script>
</body>
</html>